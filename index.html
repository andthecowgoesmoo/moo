<!DOCTYPE html>
<html>
<head>
    <title>Iframe</title>
</head>
<body>
    <h1>Iframe Content</h1>
    <p id="location">Location will be displayed here.</p>

    <script>
        function getLocation() {
            if (navigator.geolocation) {
                const options = {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                };
                navigator.geolocation.getCurrentPosition(showPosition, handleError, options);
            } else {
                sendLocationUpdate("Geolocation is not supported by this browser.");
            }
        }

        function showPosition(position) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            sendLocationUpdate(null, lat, lon);
        }

        function handleError(error) {
            let errorMessage = '';
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    errorMessage = "User denied the request for Geolocation.";
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMessage = "Location information is unavailable.";
                    break;
                case error.TIMEOUT:
                    errorMessage = "The request to get user location timed out.";
                    break;
                case error.UNKNOWN_ERROR:
                    errorMessage = "An unknown error occurred.";
                    break;
            }
            sendLocationUpdate(errorMessage);
        }
        
        function sendLocationUpdate(errorMessage = null, latitude = null, longitude = null) {
            window.parent.postMessage({
                type: 'locationUpdate',
                error: errorMessage,
                latitude: latitude,
                longitude: longitude
            }, '*'); // '*'' is used here for simplicity; ideally, it should be restricted to the parent domain.
        }

        window.addEventListener('message', function(event) {
            if (event.origin !== 'https://smokestore.shop/') {
                return; // Ignore messages from other origins
            }

            // Check for requests from the parent window to get location
            if (event.data === 'getLocation') {
                getLocation();
            }
        });
    </script>
</body>
</html>
